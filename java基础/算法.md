### 计算一个数的最小2次方数

比如50，计算后为64，即2的6次方

```java
static final int tableSizeFor(int cap) {
  int n = cap - 1;
  n |= n >>> 1;
  n |= n >>> 2;
  n |= n >>> 4;
  n |= n >>> 8;
  n |= n >>> 16;
  return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}
```



这里就是保持这个数的高位不变，低位全部变成1，这样就能保证结果比这个数大，而且是2的n次方。





# 限流算法

滑动窗口

漏桶

令牌桶:



令牌桶可以支持流量洪峰，因为他有一个桶大小容量值。漏桶则不会，因为它的出口是固定的，容量时被限制的。

令牌桶会定时生成固定的令牌，但是可以将令牌桶的容量设置为一个大的值。

比如开始时，我们的流量是100，我们的令牌桶大小是1000，每秒可以生成200个令牌，则在这种情况下，令牌桶将会维持在一个满状态。

当流量突增到500时，此时，因为令牌桶中有1000个，此时，这些流量还是会被处理掉。

